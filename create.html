<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
</head>

<body>
    <form id="userForm">
        <input type="text" id="temp" placeholder="temperature" required><br>
        <input type="text" id="humidity" placeholder="humidity" required><br>
        <input type="text" id="light" placeholder="light" required><br>
        <input type="text" id="moisture" placeholder="moisture" required><br>
        <input type="hidden" id="time" value="2021-10-10 10:10:10" required><br>
        <select name="tap" id="tap">
            <option value="true">On</option>
            <option value="false">Off</option>
        </select>
        <input type="submit" value="Submit" id="submit">
    </form>
    <script type="module">
        // Import the functions you need from the SDKs 
        import { initializeApp } from "https://www.gstatic.com/firebasejs/9.22.0/firebase-app.js";
        import { getDatabase, ref, set } from "https://www.gstatic.com/firebasejs/9.22.0/firebase-database.js";

        // Firebase configuration
        const firebaseConfig = {
            apiKey: "AIzaSyBlfnZvS9N2XBjBMiKMnlCywc-FjBnkDhQ",
            authDomain: "plnat-growth.firebaseapp.com",
            databaseURL: "https://plnat-growth-default-rtdb.asia-southeast1.firebasedatabase.app",
            projectId: "plnat-growth",
            storageBucket: "plnat-growth.firebasestorage.app",
            messagingSenderId: "714741844786",
            appId: "1:714741844786:web:ce7246947c8d5a109f252b",
            measurementId: "G-PLPRSHRBH7"
        };

        // Initialize Firebase
        const app = initializeApp(firebaseConfig);

        // Get a reference to the database service
        const db = getDatabase(app);

        // Get the form element
        const userForm = document.getElementById("userForm");

        // Add an event listener for the form submission
        userForm.addEventListener('submit', function (e) {
            e.preventDefault(); // Prevent form from reloading the page

            // Get the input values
            const temp = document.getElementById("temp").value;
            const humidity = document.getElementById("humidity").value;
            const light = document.getElementById("light").value;
            const moisture = document.getElementById("moisture").value;
            const time = document.getElementById("time").value;
            const tap = document.getElementById("tap").value;

            // Write data to Firebase Realtime Database
            set(ref(db, 'users/' + time), {
                temp: temp,
                humidity: humidity,
                light: light,
                moisture: moisture,
                time: time,
                tap: tap
            }).then(() => {
                // Alert after data is successfully written
                alert("Data saved successfully!");
                // Optional: Reset the form
                userForm.reset();
            }).catch((error) => {
                // Log errors to the console and alert the user
                console.error("Error writing data: ", error);
                alert("Error saving data: " + error.message);
            });
        });
    </script>

    <script>
        // Function to update the time field with Sri Lanka time
        function updateTimeField() {
            const now = new Date();

            // Format date in local time (Sri Lanka)
            const year = now.getFullYear();
            const month = String(now.getMonth() + 1).padStart(2, '0');
            const day = String(now.getDate()).padStart(2, '0');
            const hours = String(now.getHours()).padStart(2, '0');
            const minutes = String(now.getMinutes()).padStart(2, '0');
            const seconds = String(now.getSeconds()).padStart(2, '0');

            const formattedDate = `${year}-${month}-${day} ${hours}:${minutes}:${seconds}`;
            document.getElementById('time').value = formattedDate;
        }

        // Set time when page loads
        updateTimeField();

        // Also update time right before form submission
        document.getElementById("userForm").addEventListener('submit', function (e) {
            // Update time field with current time before submitting
            updateTimeField();
            // The rest of your form submission code will run after this
        });
    </script>
</body>

</html>